quant finance in Python

import numpy as np

def initialize(context):
    # 设置交易标的
    context.stock = '600519.SH'
    # 设置短周期与长周期
    context.short_window = 5
    context.long_window = 20
    # 设置滑点与手续费
    set_slippage(PriceRelatedSlippage(0.0001))
    set_commission(commission.PerShare(cost=0.00025, min_trade_cost=5))

def handle_data(context, data):
    stock = context.stock
    # 获取历史收盘价
    hist = history(context.long_window + 1, '1d', 'close')[stock]
    
    # 计算5日与20日均线
    ma5 = hist[-5:].mean()
    ma20 = hist.mean()
    
    # 获取当前持仓
    current_position = context.portfolio.positions[stock].amount
    
    # 金叉买入
    if ma5 > ma20 and current_position == 0:
        order_target_percent(stock, 0.99)
        log.info("金叉买入：%s" % stock)
    
    # 死叉卖出
    elif ma5 < ma20 and current_position > 0:
        order_target(stock, 0)
        log.info("死叉卖出：%s" % stock)
